<rx-panel [title]="'QR Code Library'" (onClose)="onPanelClose()">
  <div class="qr-library-panel-container">
    <section>
      <!-- Header with Create Button -->
      <div class="qr-header">
        <button class="create-qr-btn" [disabled]="creatingQRCode" (click)="showCreateQRDialog()"><i class="fas fa-plus"></i> Create QR Code</button>
      </div>

      <!-- Error Display -->
      <div *ngIf="error && !showCreateDialog" class="error-status"><i class="fas fa-exclamation-triangle"></i> {{ error }}</div>

      <!-- Loading Status -->
      <div *ngIf="loadingQRCodes" class="loading-status"><i class="fas fa-spinner fa-spin"></i> Loading QR codes...</div>

      <!-- QR Codes List -->
      <div *ngIf="!loadingQRCodes" class="qr-codes-container">
        <div *ngIf="qrCodes.length === 0 && !error" class="no-qrcodes">
          <p>No QR codes found. Create your first QR code!</p>
        </div>

        <div *ngFor="let qrCode of qrCodes" class="qr-code-item" [class.deleting]="isDeleting(qrCode.id)" (click)="selectQRCode(qrCode)">
          <div class="qr-code-preview">
            <img class="qr-image draggable-qr" draggable="true" [src]="getQRCodeImageUrl(qrCode)" [alt]="qrCode.name" [qrCodeTemplate]="qrCode" />
          </div>
          <div class="qr-code-info">
            <div class="qr-name">{{ qrCode.name }}</div>
            <div class="qr-text">{{ qrCode.text }}</div>
            <div class="qr-details">{{ getSizeDisplayText(qrCode.size) }} â€¢ {{ getErrorLevelDisplayText(qrCode.level) }}</div>
          </div>

          <!-- Delete button as overlay -->
          <div class="qr-code-actions">
            <button
              class="delete-btn"
              [disabled]="isDeleting(qrCode.id)"
              [title]="isDeleting(qrCode.id) ? 'Deleting...' : 'Delete QR Code'"
              (click)="deleteQRCode(qrCode, $event)"
            >
              <i *ngIf="!isDeleting(qrCode.id)" class="fas fa-trash"></i>
              <i *ngIf="isDeleting(qrCode.id)" class="fas fa-spinner fa-spin"></i>
            </button>
          </div>

          <!-- Delete overlay for visual feedback -->
          <div *ngIf="isDeleting(qrCode.id)" class="deleting-overlay">
            <div class="deleting-message">
              <i class="fas fa-spinner fa-spin"></i>
              <span>Deleting...</span>
            </div>
          </div>
        </div>
      </div>
    </section>
  </div>
</rx-panel>

<!-- Create QR Code Dialog -->
<rx-modal-dialog [opened]="showCreateDialog" (onClose)="hideCreateQRDialog()">
  <div class="confirm-modal-container">
    <div class="rx-modal-dialog-header">
      <img class="close" src="/assets/images/close-modal-ico.svg" (click)="hideCreateQRDialog()" />
      <span class="title">Create QR Code</span>
    </div>

    <div class="body">
      <!-- Error Display -->
      <div *ngIf="error" class="error-status"><i class="fas fa-exclamation-triangle"></i> {{ error }}</div>

      <form #qrForm="ngForm" (ngSubmit)="createQRCode()">
        <div class="form-group">
          <label for="qrText">Text/URL *</label>
          <textarea id="qrText" name="qrText" placeholder="Enter text or URL for the QR code" required rows="4" [(ngModel)]="qrText"></textarea>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label for="qrSize">Size</label>
            <select id="qrSize" name="qrSize" [(ngModel)]="qrSize">
              <option value="5">135x135px (5)</option>
              <option value="10">270x270px (10)</option>
              <option value="15">405x405px (15)</option>
              <option value="20">540x540px (20)</option>
            </select>
          </div>

          <div class="form-group">
            <label for="qrLevel">Error Correction</label>
            <select id="qrLevel" name="qrLevel" [(ngModel)]="qrLevel">
              <option *ngFor="let level of errorLevels" [value]="level.value">
                {{ level.label }}
              </option>
            </select>
          </div>
        </div>

        <div class="form-group">
          <label for="qrMargin">Margin</label>
          <input type="number" id="qrMargin" name="qrMargin" min="0" max="10" [(ngModel)]="qrMargin" />
        </div>
      </form>
    </div>

    <div class="footer">
      <button class="btn btn-light" [disabled]="creatingQRCode" (click)="hideCreateQRDialog()">CANCEL</button>
      <button class="btn btn-primary" [disabled]="!qrForm.form.valid || creatingQRCode" (click)="createQRCode()">
        <span *ngIf="creatingQRCode"> <i class="fas fa-spinner fa-spin"></i> CREATING... </span>
        <span *ngIf="!creatingQRCode">CREATE</span>
      </button>
    </div>
  </div>
</rx-modal-dialog>
