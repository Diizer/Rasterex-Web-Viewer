<div class="scale-management-container">
  <div class="scale-management-header">
    <h2>Scale Management</h2>
    <p>Manage scales and their page range assignments for accurate measurements across your document.</p>
  </div>

  <div class="scale-summary">
    <div class="summary-card">
      <div class="summary-item">
        <span class="summary-label">Total Scales:</span>
        <span class="summary-value">{{ getScaleSummary().totalScales }}</span>
      </div>
      <div class="summary-item">
        <span class="summary-label">Global Scales:</span>
        <span class="summary-value">{{ getScaleSummary().globalScales }}</span>
      </div>
      <div class="summary-item">
        <span class="summary-label">Page-Specific:</span>
        <span class="summary-value">{{ getScaleSummary().pageSpecificScales }}</span>
      </div>
    </div>
  </div>

  <div class="add-scale-section">
    <button class="add-scale-button" (click)="addNewScale()">
      <img src="/assets/images/tree-unfold.svg" alt="Add" />
      Add New Scale
    </button>
  </div>

  <div *ngIf="isAddingNewScale" class="scale-form">
    <div class="form-header">
      <h3>{{ editingScale ? "Edit Scale" : "Add New Scale" }}</h3>
      <button class="close-button" (click)="cancelEdit()">&times;</button>
    </div>

    <div class="form-content">
      <div class="form-row">
        <div class="form-group">
          <label for="scaleLabel">Scale Label</label>
          <input
            type="text"
            id="scaleLabel"
            placeholder="Enter scale label (e.g., 1:100, Custom Scale)"
            class="form-input"
            [(ngModel)]="scaleLabel"
          />
        </div>
      </div>

      <div class="form-row">
        <div class="form-group">
          <label for="scaleValue">Scale Value</label>
          <input type="text" id="scaleValue" placeholder="Enter scale value (e.g., 1:100)" class="form-input" [(ngModel)]="scaleValue" />
        </div>
      </div>

      <div class="form-row">
        <div class="form-group">
          <label for="metricType">Metric Type</label>
          <select id="metricType" class="form-select" [(ngModel)]="selectedMetricType">
            <option value="">Select metric type</option>
            <option value="metric">Metric</option>
            <option value="imperial">Imperial</option>
          </select>
        </div>
        <div class="form-group">
          <label for="metricUnit">Metric Unit</label>
          <select id="metricUnit" class="form-select" [(ngModel)]="selectedMetricUnit">
            <option value="">Select unit</option>
            <option value="Millimeter">Millimeter</option>
            <option value="Centimeter">Centimeter</option>
            <option value="Meter">Meter</option>
            <option value="Inch">Inch</option>
            <option value="Feet">Feet</option>
          </select>
        </div>
      </div>

      <div class="form-row">
        <div class="form-group">
          <label for="precision">Precision</label>
          <select id="precision" class="form-select" [(ngModel)]="selectedPrecision">
            <option value="0">0 decimal places</option>
            <option value="1">1 decimal place</option>
            <option value="2">2 decimal places</option>
            <option value="3">3 decimal places</option>
            <option value="4">4 decimal places</option>
          </select>
        </div>
      </div>

      <div class="page-range-section">
        <h4>Page Range Assignment</h4>
        <p class="section-description">Select which pages this scale should apply to. Leave empty to apply to all pages.</p>

        <div class="page-range-input-container">
          <rx-page-range-input
            placeholder="Enter page range (e.g., 1-5, 1,3,5)"
            [totalPages]="totalPages"
            [defaultToAllPages]="true"
            [(ngModel)]="selectedPageRanges"
            (rangeChange)="onPageRangeChange($event)"
          >
          </rx-page-range-input>
        </div>

        <div *ngIf="totalPages > 0" class="page-range-actions">
          <button type="button" class="action-button" (click)="setScaleForCurrentPage()">Apply to Current Page</button>
          <button type="button" class="action-button" (click)="setScaleForAllPages()">Apply to All Pages</button>
        </div>

        <div *ngIf="selectedPageRanges && selectedPageRanges.length > 0" class="page-range-info">
          <div class="range-summary">
            <strong>Scale will apply to:</strong>
            <span class="range-text">{{ getPageRangeDescription(selectedPageRangeDummyScale) }}</span>
          </div>

          <div *ngIf="hasConflictingScales()" class="conflict-warning">
            <img src="/assets/images/warning-ico.svg" alt="Warning" />
            <span>This may conflict with existing scales on some pages</span>
          </div>
        </div>
      </div>

      <div class="form-actions">
        <button class="cancel-button" (click)="cancelEdit()">Cancel</button>
        <button class="save-button" (click)="saveScale()">
          {{ editingScale ? "Update Scale" : "Add Scale" }}
        </button>
      </div>
    </div>
  </div>

  <div *ngIf="scales.length > 0" class="scales-list">
    <h3>Existing Scales</h3>

    <div class="scales-table">
      <div class="table-header">
        <div class="header-cell">Scale</div>
        <div class="header-cell">Value</div>
        <div class="header-cell">Pages</div>
        <div class="header-cell">Actions</div>
      </div>

      <div *ngFor="let scale of scales" class="table-row">
        <div class="table-cell">
          <div class="scale-info">
            <span class="scale-label">{{ scale.label }}</span>
            <span class="scale-unit">{{ scale.metricUnit }}</span>
          </div>
        </div>
        <div class="table-cell">
          <span class="scale-value">{{ scale.value }}</span>
        </div>
        <div class="table-cell">
          <span class="page-range">{{ getPageRangeDescription(scale) }}</span>
        </div>
        <div class="table-cell">
          <div class="action-buttons">
            <button class="action-btn apply-btn" title="Apply scale" (click)="applyScale(scale)">
              <img src="/assets/images/check-ico.svg" alt="Apply" />
            </button>
            <button class="action-btn edit-btn" title="Edit scale" (click)="editScale(scale)">
              <img src="/assets/images/edit-ico.svg" alt="Edit" />
            </button>
            <button class="action-btn delete-btn" title="Delete scale" (click)="deleteScale(scale)">
              <img src="/assets/images/trash-ico.svg" alt="Delete" />
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div *ngIf="scales.length === 0 && !isAddingNewScale" class="empty-state">
    <div class="empty-icon">
      <img src="/assets/images/annotation-ico.svg" alt="No scales" />
    </div>
    <h3>No scales defined</h3>
    <p>Create your first scale to get started with accurate measurements.</p>
    <button class="add-scale-button" (click)="addNewScale()">
      <img src="/assets/images/tree-unfold.svg" alt="Add" />
      Add Your First Scale
    </button>
  </div>

  <div *ngIf="totalPages > 0" class="page-overview">
    <h3>Page Overview</h3>
    <div class="pages-grid">
      <div
        *ngFor="let pageNum of [].constructor(totalPages); let i = index"
        class="page-item"
        [class.current-page]="i === currentPage"
        [class.has-scale]="getScalesForPage(i + 1).length > 0"
      >
        <div class="page-number">{{ i + 1 }}</div>
        <div *ngIf="getScalesForPage(i + 1).length > 0" class="page-scales">
          <span class="scale-count">{{ getScalesForPage(i + 1).length }} scale(s)</span>
        </div>
      </div>
    </div>
  </div>
</div>
